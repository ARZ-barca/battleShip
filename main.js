!function(){"use strict";function t(t,r){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);r&&(e=e.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),n.push.apply(n,e)}return n}function r(r){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?t(Object(o),!0).forEach((function(t){n(r,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach((function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(o,t))}))}return r}function n(t,r,n){return r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t}function e(t,r){if(t){if("string"==typeof t)return o(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,r):void 0}}function o(t,r){(null==r||r>t.length)&&(r=t.length);for(var n=0,e=new Array(r);n<r;n++)e[n]=t[n];return e}function i(t,r,n){var e=[];if("x"===n)for(var o=t[0],i=t[1],a=0;a<r;a++)e.push([o,+i+a]);else if("y"===n)for(var u=t[0],c=t[1],f=0;f<r;f++)e.push([+u+f,c]);return e}var a=function(t,n,o){var a,u={positions:{},createPos:t,axis:o,len:n},c=i(t,n,o),f=function(t,r){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=e(t))){n&&(t=n);var o=0,i=function(){};return{s:i,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,u=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return u=t.done,t},e:function(t){c=!0,a=t},f:function(){try{u||null==n.return||n.return()}finally{if(c)throw a}}}}(c);try{for(f.s();!(a=f.n()).done;){var l=a.value;u.positions[String(l)]="good"}}catch(t){f.e(t)}finally{f.f()}var s,p,y=(s=c.slice(-1),p=1,function(t){if(Array.isArray(t))return t}(s)||function(t,r){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var e,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(e=n.next()).done)&&(i.push(e.value),!r||i.length!==r);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(s,p)||e(s,p)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());return u.lastPosition=y[0],r(r(r(r(r({},function(t){return{getPositions:function(){return t.positions}}}(u)),function(t){return{getLen:function(){return t.len}}}(u)),function(t){return{getCreatePos:function(){return t.createPos}}}(u)),function(t){return{getLastPos:function(){return t.lastPosition}}}(u)),function(t){return{getAxis:function(){return t.axis}}}(u))};function u(t,r){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);r&&(e=e.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),n.push.apply(n,e)}return n}function c(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?u(Object(n),!0).forEach((function(r){f(t,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))}))}return t}function f(t,r,n){return r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t}function l(t,r){(null==r||r>t.length)&&(r=t.length);for(var n=0,e=new Array(r);n<r;n++)e[n]=t[n];return e}function s(t,r,n){r.forEach((function(r){t.positions[String(r)]=n}))}function p(t){return Object.keys(t.getPositions())}function y(t,r){var n=p(r),e=[];return n.forEach((function(r){for(var n=r.split(","),o=-1;o<2;o+=1)for(var i=-1;i<2;i+=1){var a=String([+n[0]+o,+n[1]+i]);"empty"!==t.positions[a]&&"unavailable"!==t.positions[a]||e.includes(a)||e.push(a)}})),e}function d(t,r,n,e){var o=a(r,n,e);return function(t,r){s(t,p(r),"ship")}(t,o),function(t,r){s(t,y(t,r),"unavailable")}(t,o),function(t,r){t.ships.push(r)}(t,o),o}function b(t,r){!function(t,r){s(t,p(r),"empty")}(t,r),function(t,r){s(t,y(t,r),"empty")}(t,r),function(t,r){var n=t.ships.indexOf(r);t.ships.splice(n,1)}(t,r)}var m=function(t){return{checkPlacement:function(r,n,e){return function(t,r,n,e){var o,a=function(t,r){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,r){if(t){if("string"==typeof t)return l(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){n&&(t=n);var e=0,o=function(){};return{s:o,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}(i(r,n,e));try{for(a.s();!(o=a.n()).done;){var u=o.value;if("empty"!==t.positions[String(u)])return!1}}catch(t){a.e(t)}finally{a.f()}return!0}(t,r,n,e)}}},v=function(t){for(var r={positions:{},ships:[],gameBoardLen:t},n=0;n<t;n++)for(var e=0;e<t;e++)r.positions[String([n,e])]="empty";return c(c(c(c(c(c(c({},function(t){return{getPositions:function(){return t.positions}}}(r)),function(t){return{getShips:function(){return t.ships}}}(r)),function(t){return{createShip:function(r,n,e){return d(t,r,n,e)}}}(r)),function(t){return{removeShip:function(r){b(t,r)}}}(r)),function(t){return{changeShipAxis:function(r,n){return function(t,r){return b(t,r),d(t,r.getCreatePos(),r.getLen(),"x"===r.getAxis()?"y":"x")}(t,r)}}}(r)),m(r)),function(t){return{getPositionsAroundShip:function(r){return y(t,r)}}}(r))};function h(t,r){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);r&&(e=e.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),n.push.apply(n,e)}return n}function g(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?h(Object(n),!0).forEach((function(r){O(t,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))}))}return t}function O(t,r,n){return r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t}function S(t,r){(null==r||r>t.length)&&(r=t.length);for(var n=0,e=new Array(r);n<r;n++)e[n]=t[n];return e}var j=10;function P(t,r,n,e){return t.gameBoard.checkPlacement(r,n,e)}function w(t){return t[Math.floor(t.length*Math.random())]}var A=function(t){return{clear:function(){!function(t){for(var r=function(t){if(Array.isArray(t))return S(t)}(e=t.gameBoard.getShips())||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(t,r){if(t){if("string"==typeof t)return S(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(t,r):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),n=0;n<r.length;n++)t.gameBoard.removeShip(r[n]);var e}(t)}}},E=function(){var t={gameBoard:v(j),gameBoardLen:j};return g(g(g(g(g(g(g(g({},function(t){return{getGameBoard:function(){return t.gameBoard}}}(t)),function(t){return{getGameBoardLen:function(){return t.gameBoardLen}}}(t)),function(t){return{createShip:function(r,n,e){return function(t,r,n,e){return t.gameBoard.createShip(r,n,e)}(t,r,n,e)}}}(t)),function(t){return{checkPlacement:function(r,n,e){return P(t,r,n,e)}}}(t)),function(t){return{removeShip:function(r){!function(t,r){t.gameBoard.removeShip(r)}(t,r)}}}(t)),function(t){return{changeShipAxis:function(r){return function(t,r){return t.gameBoard.changeShipAxis(r)}(t,r)}}}(t)),function(t){return{getRandomShip:function(r){return function(t,r){for(var n=[],e=0;e<j;e++)for(var o=0;o<j;o++)n.push([e,o]);for(;;){var i=w(n),u=Math.floor(100*Math.random())%2==0?"x":"y";if(P(t,i,r,u))return a(i,r,u);var c="x"===u?"y":"x";if(P(t,i,r,c))return a(i,r,c);n.splice(n.indexOf(i),1)}}(t,r)}}}(t)),A(t))};function x(t,r){(null==r||r>t.length)&&(r=t.length);for(var n=0,e=new Array(r);n<r;n++)e[n]=t[n];return e}var I=[4,3,3,2,2,2,1,1,1,1];!function(t){var r=function(){for(var t=document.createElement("div"),r=0;r<j;r++)for(var n=0;n<j;n++){var e=document.createElement("div");e.classList.add("position","p-".concat(r,"-").concat(n)),t.appendChild(e)}return t.classList.add("game-board"),t}(),n=E(),e=document.createElement("div");e.classList.add("board-container"),e.appendChild(r);var o=document.createElement("button");o.textContent="random",o.classList.add("random"),t.appendChild(e),t.appendChild(o),o.addEventListener("click",(function(){n.clear(),function(t){var r;(r=t.children,function(t){if(Array.isArray(t))return x(t)}(r)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(r)||function(t,r){if(t){if("string"==typeof t)return x(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(t,r):void 0}}(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).forEach((function(t){t.classList.remove("ship")}))}(r),function(t,r,n){n.forEach((function(n){var e=t.getRandomShip(n);!function(t,r,n,e,o){var a=t.createShip(n,e,o);(function(t,r){t.forEach((function(t){var n=".p-".concat(String(t).replace(",","-"));r.querySelector(n).classList.add("ship")}))})(i(n,e,o),r)}(t,r,e.getCreatePos(),n,e.getAxis())}))}(n,r,I)}))}(document.querySelector("main"))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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aEIsR0FDckIsSUFBTTRGLEVBQVcsTUFBSCxPQUFTM0YsT0FBT0QsR0FBRzZGLFFBQVEsSUFBSyxNQUNsQ3BCLEVBQVNxQixjQUFjRixHQUMvQmQsVUFBVUMsSUFBSSxPQUNuQixHQUNGLEVEZENnQixDQURzQjFHLEVBQXFCQyxFQUFXQyxFQUFLQyxHQUM1QmlGLEVBRWhDLENBK0JHN0MsQ0FBV3NELEVBQVFULEVBQVV2RCxFQUFLVixlQUFnQmpCLEVBQUsyQixFQUFLTixVQUM3RCxHQUNGLENBbUJHb0YsQ0FBb0JkLEVBQVFULEVBQVVGLEVBQ3ZDLEdBQ0YsQ0VyRUQwQixDQURnQnRCLFNBQVNtQixjQUFjLFEiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL3NoaXBzLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZUJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvcGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvc2V0dXAuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9zZXR1cC1kb20uanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAvLyBtZXRob2QgdGhhdCBtYXJrcyBhIHBvc2l0aW9uIGFzIGhpdFxuLy8gZnVuY3Rpb24gYWRkSGl0KHN0YXRlKSB7XG4vLyAgIHJldHVybiB7XG4vLyAgICAgaGl0KGhpdFBvc2l0aW9uKSB7XG4vLyAgICAgICBzdGF0ZS5wb3NpdGlvbnNbU3RyaW5nKGhpdFBvc2l0aW9uKV0gPSBcImhpdFwiO1xuLy8gICAgIH0sXG4vLyAgIH07XG4vLyB9XG5cbi8vIC8vIGNoZWNrIGlmIHNoaXAgaXMgc3Vua1xuLy8gY29uc3QgYWRkSXNTdW5rID0gKHN0YXRlKSA9PiAoe1xuLy8gICBpc1N1bmsoKSB7XG4vLyAgICAgcmV0dXJuIE9iamVjdC52YWx1ZXMoc3RhdGUucG9zaXRpb25zKS5ldmVyeSgodmFsdWUpID0+IHZhbHVlID09PSBcImhpdFwiKTtcbi8vICAgfSxcbi8vIH0pO1xuXG4vLyBtZXRob2QgZm9yIGdldHRpbmcgcG9zaXRpb25zIG9mIHNoaXBcbmNvbnN0IGFkZEdldFBvc2l0aW9ucyA9IChzdGF0ZSkgPT4gKHtcbiAgZ2V0UG9zaXRpb25zKCkge1xuICAgIHJldHVybiBzdGF0ZS5wb3NpdGlvbnM7XG4gIH0sXG59KTtcblxuY29uc3QgYWRkR2V0TGVuID0gKHN0YXRlKSA9PiAoe1xuICBnZXRMZW4oKSB7XG4gICAgcmV0dXJuIHN0YXRlLmxlbjtcbiAgfSxcbn0pO1xuXG5jb25zdCBhZGRHZXRBeGlzID0gKHN0YXRlKSA9PiAoe1xuICBnZXRBeGlzKCkge1xuICAgIHJldHVybiBzdGF0ZS5heGlzO1xuICB9LFxufSk7XG5cbmNvbnN0IGFkZEdldENyZWF0ZVBvcyA9IChzdGF0ZSkgPT4gKHtcbiAgZ2V0Q3JlYXRlUG9zKCkge1xuICAgIHJldHVybiBzdGF0ZS5jcmVhdGVQb3M7XG4gIH0sXG59KTtcblxuY29uc3QgYWRkR2V0TGFzdFBvcyA9IChzdGF0ZSkgPT4gKHtcbiAgZ2V0TGFzdFBvcygpIHtcbiAgICByZXR1cm4gc3RhdGUubGFzdFBvc2l0aW9uO1xuICB9LFxufSk7XG5cbi8vIHByZWRpY3RzIHNoaXAgcG9zaXRpb25zIGlmIGNyZWF0ZWQgdG8gY2hlY2sgZm9yIHRoZWlyIHZhbGlkaXR5XG5mdW5jdGlvbiBwcmVkaWN0U2hpcFBvc2l0aW9ucyhjcmVhdGVQb3MsIGxlbiwgYXhpcykge1xuICBjb25zdCBwb3NpdGlvbnMgPSBbXTtcbiAgaWYgKGF4aXMgPT09IFwieFwiKSB7XG4gICAgZm9yIChsZXQgaSA9IGNyZWF0ZVBvc1swXSwgaiA9IGNyZWF0ZVBvc1sxXSwgayA9IDA7IGsgPCBsZW47IGsrKykge1xuICAgICAgcG9zaXRpb25zLnB1c2goW2ksICtqICsga10pO1xuICAgIH1cbiAgfSBlbHNlIGlmIChheGlzID09PSBcInlcIikge1xuICAgIGZvciAobGV0IGkgPSBjcmVhdGVQb3NbMF0sIGogPSBjcmVhdGVQb3NbMV0sIGsgPSAwOyBrIDwgbGVuOyBrKyspIHtcbiAgICAgIHBvc2l0aW9ucy5wdXNoKFsraSArIGssIGpdKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHBvc2l0aW9ucztcbn1cblxuLy8gZ2FtZWJvYXJkIGZhY3RvcnkgZnVuY3Rpb25cbmZ1bmN0aW9uIFNoaXAoY3JlYXRlUG9zLCBsZW4sIGF4aXMpIHtcbiAgY29uc3Qgc3RhdGUgPSB7XG4gICAgcG9zaXRpb25zOiB7fSxcbiAgICBjcmVhdGVQb3MsXG4gICAgYXhpcyxcbiAgICBsZW4sXG4gIH07XG4gIC8vIHBvcHVsYXRpbmcgdGhlIHBvc2l0aW9ucyBvZiB0aGUgc2hpcFxuICBjb25zdCBwcmVkaWN0ZWRQb3NpdGlvbnMgPSBwcmVkaWN0U2hpcFBvc2l0aW9ucyhjcmVhdGVQb3MsIGxlbiwgYXhpcyk7XG4gIGZvciAoY29uc3QgcCBvZiBwcmVkaWN0ZWRQb3NpdGlvbnMpIHtcbiAgICBzdGF0ZS5wb3NpdGlvbnNbU3RyaW5nKHApXSA9IFwiZ29vZFwiO1xuICB9XG5cbiAgLy8gc2V0IGVuZFBvc3Rpb24gZm9yIHNoaXBcbiAgW3N0YXRlLmxhc3RQb3NpdGlvbl0gPSBwcmVkaWN0ZWRQb3NpdGlvbnMuc2xpY2UoLTEpO1xuXG4gIHJldHVybiB7XG4gICAgLi4uYWRkR2V0UG9zaXRpb25zKHN0YXRlKSxcbiAgICAvLyAuLi5hZGRJc1N1bmsoc3RhdGUpLFxuICAgIC8vIC4uLmFkZEhpdChzdGF0ZSksXG4gICAgLi4uYWRkR2V0TGVuKHN0YXRlKSxcbiAgICAuLi5hZGRHZXRDcmVhdGVQb3Moc3RhdGUpLFxuICAgIC4uLmFkZEdldExhc3RQb3Moc3RhdGUpLFxuICAgIC4uLmFkZEdldEF4aXMoc3RhdGUpLFxuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBTaGlwO1xuZXhwb3J0IHsgcHJlZGljdFNoaXBQb3NpdGlvbnMgfTtcbiIsImltcG9ydCBTaGlwLCB7IHByZWRpY3RTaGlwUG9zaXRpb25zIH0gZnJvbSBcIi4vc2hpcHNcIjtcblxuLy8gY2hhbmdlIHRoZSBnaXZlbiBwb3NpdGlvbnMgaW4gdGhlIGdhbWUgYm9hcmRzXG5mdW5jdGlvbiBjaGFuZ2VHYW1lQm9hcmRQb3NpdGlvbnMoc3RhdGUsIHBvc2l0aW9ucywgdmFsdWUpIHtcbiAgcG9zaXRpb25zLmZvckVhY2goKHApID0+IHtcbiAgICBzdGF0ZS5wb3NpdGlvbnNbU3RyaW5nKHApXSA9IHZhbHVlO1xuICB9KTtcbn1cblxuLy8gZ2V0IHRoZSBzaGlwIHBvc2l0aW9ucyBhcyBhIGxpc3RcbmZ1bmN0aW9uIGdldFNoaXBQb3NpdGlvbnMoc2hpcCkge1xuICByZXR1cm4gT2JqZWN0LmtleXMoc2hpcC5nZXRQb3NpdGlvbnMoKSk7XG59XG5cbi8vIGNoYW5nZXMgcG9zaXRpb25zIGluIGdhbWUgYm9hcmQgdG8gJ3NoaXAnXG5mdW5jdGlvbiBjaGFuZ2VTaGlwUG9zaXRpb25zKHN0YXRlLCBzaGlwKSB7XG4gIGNvbnN0IHNoaXBQb3NpdGlvbnMgPSBnZXRTaGlwUG9zaXRpb25zKHNoaXApO1xuICBjaGFuZ2VHYW1lQm9hcmRQb3NpdGlvbnMoc3RhdGUsIHNoaXBQb3NpdGlvbnMsIFwic2hpcFwiKTtcbn1cblxuLy8gZ2V0IHBvc2l0aW9ucyBhcnJvdW5kIHNoaXBcbmZ1bmN0aW9uIGdldFBvc2l0aW9uc0Fyb3VuZFNoaXAoc3RhdGUsIHNoaXApIHtcbiAgY29uc3Qgc2hpcFBvc2l0aW9ucyA9IGdldFNoaXBQb3NpdGlvbnMoc2hpcCk7XG4gIGNvbnN0IGFyb3VuZFBvc2l0aW9ucyA9IFtdO1xuICBzaGlwUG9zaXRpb25zLmZvckVhY2goKHApID0+IHtcbiAgICBjb25zdCBwQXNMaXN0ID0gcC5zcGxpdChcIixcIik7XG4gICAgZm9yIChsZXQgaSA9IC0xOyBpIDwgMjsgaSArPSAxKSB7XG4gICAgICBmb3IgKGxldCBqID0gLTE7IGogPCAyOyBqICs9IDEpIHtcbiAgICAgICAgY29uc3QgbmV3UG9zID0gU3RyaW5nKFsrcEFzTGlzdFswXSArIGksICtwQXNMaXN0WzFdICsgal0pO1xuICAgICAgICBpZiAoXG4gICAgICAgICAgKHN0YXRlLnBvc2l0aW9uc1tuZXdQb3NdID09PSBcImVtcHR5XCIgfHxcbiAgICAgICAgICAgIHN0YXRlLnBvc2l0aW9uc1tuZXdQb3NdID09PSBcInVuYXZhaWxhYmxlXCIpICYmXG4gICAgICAgICAgIWFyb3VuZFBvc2l0aW9ucy5pbmNsdWRlcyhuZXdQb3MpXG4gICAgICAgICkge1xuICAgICAgICAgIGFyb3VuZFBvc2l0aW9ucy5wdXNoKG5ld1Bvcyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuICByZXR1cm4gYXJvdW5kUG9zaXRpb25zO1xufVxuXG4vLyBhZGRzIGdldCBwb3NpdGlvbnMgYXJvdW5kIHNoaXAgbWV0aG9kIHRvIG9iamVjdFxuY29uc3QgYWRkR2V0UG9zaXRpb25zQXJvdW5kU2hpcCA9IChzdGF0ZSkgPT4gKHtcbiAgZ2V0UG9zaXRpb25zQXJvdW5kU2hpcDogKHNoaXApID0+IGdldFBvc2l0aW9uc0Fyb3VuZFNoaXAoc3RhdGUsIHNoaXApLFxufSk7XG5cbi8vIGNoYW5nZXMgYXJyb3VuZCB0aGUgc2hpcCBwb3NpdGlvbnMgdG8gJ3VuYXZhaWxhYmxlJ1xuZnVuY3Rpb24gY2hhbmdlQXJvdW5kU2hpcFBvc2l0aW9ucyhzdGF0ZSwgc2hpcCkge1xuICBjb25zdCBhcm91bmRQb3NpdGlvbnMgPSBnZXRQb3NpdGlvbnNBcm91bmRTaGlwKHN0YXRlLCBzaGlwKTtcbiAgY2hhbmdlR2FtZUJvYXJkUG9zaXRpb25zKHN0YXRlLCBhcm91bmRQb3NpdGlvbnMsIFwidW5hdmFpbGFibGVcIik7XG59XG5cbi8vIGFkZCBzaGlwIHRvIHRoZSBnYW1lYm9hcmQgc2hpcHNcbmZ1bmN0aW9uIGFkZFNoaXBUb0dhbWVCb2FyZFNoaXBzKHN0YXRlLCBzaGlwKSB7XG4gIHN0YXRlLnNoaXBzLnB1c2goc2hpcCk7XG59XG5cbi8vIG1ldGhvZCBmb3IgcGxhY2luZyBzaGlwcyBpbiBnYW1lYm9hcmQgKHJldHVybnMgdGhlIHNoaXApXG5mdW5jdGlvbiBjcmVhdGVTaGlwKHN0YXRlLCBjcmVhdGVQb3MsIGxlbiwgYXhpcykge1xuICBjb25zdCBzaGlwID0gU2hpcChjcmVhdGVQb3MsIGxlbiwgYXhpcyk7XG4gIGNoYW5nZVNoaXBQb3NpdGlvbnMoc3RhdGUsIHNoaXApO1xuICBjaGFuZ2VBcm91bmRTaGlwUG9zaXRpb25zKHN0YXRlLCBzaGlwKTtcbiAgYWRkU2hpcFRvR2FtZUJvYXJkU2hpcHMoc3RhdGUsIHNoaXApO1xuICByZXR1cm4gc2hpcDtcbn1cblxuLy8gYWRkcyB0aGUgY3JlYXRlU2hpcCBtZXRob2QgdG8gb2JqZWN0XG5jb25zdCBhZGRDcmVhdGVTaGlwID0gKHN0YXRlKSA9PiAoe1xuICBjcmVhdGVTaGlwOiAoY3JlYXRlUG9zLCBsZW4sIGF4aXMpID0+IGNyZWF0ZVNoaXAoc3RhdGUsIGNyZWF0ZVBvcywgbGVuLCBheGlzKSxcbn0pO1xuXG4vLyBtYWtlcyB0aGUgc2hpcCBwb3NpdGlvbnMgJ2VtcHR5J1xuZnVuY3Rpb24gZW1wdHlTaGlwUG9zaXRpb25zKHN0YXRlLCBzaGlwKSB7XG4gIGNvbnN0IHNoaXBQb3NpdGlvbnMgPSBnZXRTaGlwUG9zaXRpb25zKHNoaXApO1xuICBjaGFuZ2VHYW1lQm9hcmRQb3NpdGlvbnMoc3RhdGUsIHNoaXBQb3NpdGlvbnMsIFwiZW1wdHlcIik7XG59XG5cbi8vIG1ha2VzIGFyb3VuZCB0aGUgc2hpcCdzIHBvc2l0aW9uIGVtcHR5XG5mdW5jdGlvbiBlbXB0eUFyb3VuZFNoaXBQb3NpdGlvbihzdGF0ZSwgc2hpcCkge1xuICBjb25zdCBhcm91bmRQb3NpdGlvbnMgPSBnZXRQb3NpdGlvbnNBcm91bmRTaGlwKHN0YXRlLCBzaGlwKTtcbiAgY2hhbmdlR2FtZUJvYXJkUG9zaXRpb25zKHN0YXRlLCBhcm91bmRQb3NpdGlvbnMsIFwiZW1wdHlcIik7XG59XG5cbi8vIHJlbW92ZXMgdGhlIHNoaXAgZnJvbSBnYW1lQm9hcmQgc2hpcHNcbmZ1bmN0aW9uIHJlbW92ZVNoaXBGcm9tR2FtZUJvYXJkU2hpcHMoc3RhdGUsIHNoaXApIHtcbiAgY29uc3Qgc2hpcEluZGV4ID0gc3RhdGUuc2hpcHMuaW5kZXhPZihzaGlwKTtcbiAgc3RhdGUuc2hpcHMuc3BsaWNlKHNoaXBJbmRleCwgMSk7XG59XG5cbi8vIG1ldGhvZCBmb3IgcmVtb3ZpbmcgdGhlIHNoaXAgKG5lZWRzIG9uZSBhcmcpXG5mdW5jdGlvbiByZW1vdmVTaGlwKHN0YXRlLCBzaGlwKSB7XG4gIGVtcHR5U2hpcFBvc2l0aW9ucyhzdGF0ZSwgc2hpcCk7XG4gIGVtcHR5QXJvdW5kU2hpcFBvc2l0aW9uKHN0YXRlLCBzaGlwKTtcbiAgcmVtb3ZlU2hpcEZyb21HYW1lQm9hcmRTaGlwcyhzdGF0ZSwgc2hpcCk7XG59XG5cbi8vIGFkZHMgcmVtb3Zlc2hpcCBtZXRob2QgdG8gYW4gb2JqZWN0XG5jb25zdCBhZGRSZW1vdmVTaGlwID0gKHN0YXRlKSA9PiAoe1xuICByZW1vdmVTaGlwOiAoc2hpcCkgPT4ge1xuICAgIHJlbW92ZVNoaXAoc3RhdGUsIHNoaXApO1xuICB9LFxufSk7XG5cbi8vIG1ldGhvZCBmb3IgcmVwb3NpdGlvbmluZyB0aGUgc2hpcFxuZnVuY3Rpb24gY2hhbmdlU2hpcEF4aXMoc3RhdGUsIHNoaXApIHtcbiAgcmVtb3ZlU2hpcChzdGF0ZSwgc2hpcCk7XG4gIGNvbnN0IHNoaXBDcmVhdGVQb3MgPSBzaGlwLmdldENyZWF0ZVBvcygpO1xuICBjb25zdCBzaGlwTGVuID0gc2hpcC5nZXRMZW4oKTtcbiAgY29uc3QgbmV3QXhpcyA9IHNoaXAuZ2V0QXhpcygpID09PSBcInhcIiA/IFwieVwiIDogXCJ4XCI7XG4gIGNvbnN0IG5ld1NoaXAgPSBjcmVhdGVTaGlwKHN0YXRlLCBzaGlwQ3JlYXRlUG9zLCBzaGlwTGVuLCBuZXdBeGlzKTtcbiAgcmV0dXJuIG5ld1NoaXA7XG59XG5cbi8vIGFkZHMgY2hhbmdlU2hpcEF4aXggbWV0aG9kIHRvIGFuIG9iamVjdFxuY29uc3QgYWRkQ2hhbmdlU2hpcEF4aXMgPSAoc3RhdGUpID0+ICh7XG4gIGNoYW5nZVNoaXBBeGlzOiAoc2hpcCwgbmV3QXhpcykgPT4gY2hhbmdlU2hpcEF4aXMoc3RhdGUsIHNoaXAsIG5ld0F4aXMpLFxufSk7XG5cbi8vIG1ldGhvZCB0aGF0IGNoZWNrcyBmb3IgcGxhY2VtZW50IHZhbGlkaXR5XG5mdW5jdGlvbiBjaGVja1BsYWNlbWVudChzdGF0ZSwgY3JlYXRlUG9zLCBsZW4sIGF4aXMpIHtcbiAgY29uc3QgcHJlZGljdGVkUG9zaXRpb25zID0gcHJlZGljdFNoaXBQb3NpdGlvbnMoY3JlYXRlUG9zLCBsZW4sIGF4aXMpO1xuICBmb3IgKGNvbnN0IHAgb2YgcHJlZGljdGVkUG9zaXRpb25zKSB7XG4gICAgaWYgKHN0YXRlLnBvc2l0aW9uc1tTdHJpbmcocCldICE9PSBcImVtcHR5XCIpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59XG5cbi8vIGFkZHMgY2hlY2tQbGFjZW1lbnQgbWV0aG9kIHRvIGFuIG9iamVjdFxuY29uc3QgYWRkQ2hlY2tQbGFjZW1lbnQgPSAoc3RhdGUpID0+ICh7XG4gIGNoZWNrUGxhY2VtZW50OiAoY3JlYXRlUG9zLCBsZW4sIGF4aXMpID0+XG4gICAgY2hlY2tQbGFjZW1lbnQoc3RhdGUsIGNyZWF0ZVBvcywgbGVuLCBheGlzKSxcbn0pO1xuXG4vLyBtZXRob2QgZm9yIGdldHRpbmcgdGhlIHBvc2l0aW9ucyBvZiBnYW1lIGJvYXJkXG5jb25zdCBhZGRHZXRQb3NpdGlvbnMgPSAoc3RhdGUpID0+ICh7XG4gIGdldFBvc2l0aW9ucygpIHtcbiAgICByZXR1cm4gc3RhdGUucG9zaXRpb25zO1xuICB9LFxufSk7XG5cbi8vIG1ldGhvZCBmb3IgZ2V0dGluZyB0aGUgc2hpcHMgb2YgZ2FtZSBib2FyZFxuY29uc3QgYWRkR2V0U2hpcHMgPSAoc3RhdGUpID0+ICh7XG4gIGdldFNoaXBzKCkge1xuICAgIHJldHVybiBzdGF0ZS5zaGlwcztcbiAgfSxcbn0pO1xuXG4vLyAvLyByZXR1cm5zIHRoZSBzaGlwIHRoYXQgZ290IGhpdFxuLy8gZnVuY3Rpb24gZ2V0SGl0U2hpcChzaGlwcywgYXR0YWNrUG9zaXRpb24pIHtcbi8vICAgZm9yIChjb25zdCBzaGlwIG9mIHNoaXBzKSB7XG4vLyAgICAgaWYgKE9iamVjdC5rZXlzKHNoaXAuZ2V0UG9zaXRpb25zKCkpLmluY2x1ZGVzKFN0cmluZyhhdHRhY2tQb3NpdGlvbikpKSB7XG4vLyAgICAgICByZXR1cm4gc2hpcDtcbi8vICAgICB9XG4vLyAgIH1cbi8vIH1cblxuLy8gLy8gbWFyayBhcm91bmQgYSBzaGlwIGluIGdhbWUgYm9hcmQgYXMgdW5hdmFpbGFibGVTaG90IGZvciBoaXRcbi8vIGZ1bmN0aW9uIG1hcmtBcm91bmRTaGlwKHN0YXRlLCBzaGlwKSB7XG4vLyAgIGNvbnN0IGFyb3VuZFBvc2l0aW9ucyA9IGdldFBvc2l0aW9uc0Fyb3VuZFNoaXAoc3RhdGUsIHNoaXApO1xuLy8gICBhcm91bmRQb3NpdGlvbnMuZm9yRWFjaCgocCkgPT4ge1xuLy8gICAgIGlmICghc3RhdGUubWlzc2VkU2hvdHMuaW5jbHVkZXMocCkgJiYgIXN0YXRlLnVuYXZhaWxhYmxlU2hvdHMuaW5jbHVkZXMocCkpIHtcbi8vICAgICAgIHN0YXRlLnVuYXZhaWxhYmxlU2hvdHMucHVzaChwKTtcbi8vICAgICB9XG4vLyAgIH0pO1xuLy8gfVxuXG4vLyAvLyBjaGVja3MgYW4gYXR0YWNrIGZvciBoaXQgb3IgbWlzc1xuLy8gZnVuY3Rpb24gY2hlY2tBdHRhY2soc3RhdGUsIGF0dGFja1Bvc2l0aW9uKSB7XG4vLyAgIGlmIChzdGF0ZS5wb3NpdGlvbnNbU3RyaW5nKGF0dGFja1Bvc2l0aW9uKV0gPT09IFwic2hpcFwiKSB7XG4vLyAgICAgcmV0dXJuIHRydWU7XG4vLyAgIH1cbi8vICAgcmV0dXJuIGZhbHNlO1xuLy8gfVxuXG4vLyAvLyBhZGQgY2hlY2sgYXR0YWNrXG4vLyBjb25zdCBhZGRDaGVja0F0dGFjayA9IChzdGF0ZSkgPT4gKHtcbi8vICAgY2hlY2tBdHRhY2s6IChhdHRhY2tQb3NpdGlvbikgPT4gY2hlY2tBdHRhY2soc3RhdGUsIGF0dGFja1Bvc2l0aW9uKSxcbi8vIH0pO1xuXG4vLyAvLyBtZXRob2QgZm9yIHJlY2VpZXZlaW5nIGFuIGF0dGFja1xuLy8gZnVuY3Rpb24gcmVjZWl2ZUF0dGFjayhzdGF0ZSwgYXR0YWNrUG9zaXRpb24pIHtcbi8vICAgaWYgKGNoZWNrQXR0YWNrKHN0YXRlLCBhdHRhY2tQb3NpdGlvbikpIHtcbi8vICAgICBzdGF0ZS5oaXRTaG90cy5wdXNoKFN0cmluZyhhdHRhY2tQb3NpdGlvbikpO1xuLy8gICAgIGNvbnN0IHNoaXAgPSBnZXRIaXRTaGlwKHN0YXRlLnNoaXBzLCBhdHRhY2tQb3NpdGlvbik7XG4vLyAgICAgc2hpcC5oaXQoYXR0YWNrUG9zaXRpb24pO1xuLy8gICAgIGlmIChzaGlwLmlzU3VuaygpKSB7XG4vLyAgICAgICBtYXJrQXJvdW5kU2hpcChzdGF0ZSwgc2hpcCk7XG4vLyAgICAgfVxuLy8gICB9IGVsc2Uge1xuLy8gICAgIHN0YXRlLm1pc3NlZFNob3RzLnB1c2goU3RyaW5nKGF0dGFja1Bvc2l0aW9uKSk7XG4vLyAgIH1cbi8vIH1cblxuLy8gLy8gYWRkcyByZWNlaXZlQXR0YWNrIG1ldGhvZCB0byBhbiBvYmplY3Rcbi8vIGNvbnN0IGFkZFJlY2VpdmVBdHRhY2sgPSAoc3RhdGUpID0+ICh7XG4vLyAgIHJlY2VpdmVBdHRhY2s6IChhdHRhY2tQb3NpdGlvbikgPT4gcmVjZWl2ZUF0dGFjayhzdGF0ZSwgYXR0YWNrUG9zaXRpb24pLFxuLy8gfSk7XG5cbi8vIC8vIG1ldGhvZCBmb3IgZ2V0dGluZyBhdHRhY2tzIG9uIGEgc2hpcFxuLy8gY29uc3QgYWRkR2V0QXR0YWNrcyA9IChzdGF0ZSkgPT4gKHtcbi8vICAgZ2V0QXR0YWNrcygpIHtcbi8vICAgICBjb25zdCB7IG1pc3NlZFNob3RzIH0gPSBzdGF0ZTtcbi8vICAgICBjb25zdCB7IGhpdFNob3RzIH0gPSBzdGF0ZTtcbi8vICAgICBjb25zdCB7IHVuYXZhaWxhYmxlU2hvdHMgfSA9IHN0YXRlO1xuLy8gICAgIHJldHVybiB7IG1pc3NlZFNob3RzLCBoaXRTaG90cywgdW5hdmFpbGFibGVTaG90cyB9O1xuLy8gICB9LFxuLy8gfSk7XG5cbi8vIC8vIG1ldGhvZCBmb3IgY2hlY2tpbmcgaWYgdGhlIGdhbWUgaXMgb3ZlclxuLy8gZnVuY3Rpb24gaXNHYW1lT3ZlcihzdGF0ZSkge1xuLy8gICBsZXQgZ2FtZU92ZXIgPSB0cnVlO1xuLy8gICBzdGF0ZS5zaGlwcy5mb3JFYWNoKChzaGlwKSA9PiB7XG4vLyAgICAgaWYgKCFzaGlwLmlzU3VuaygpKSB7XG4vLyAgICAgICBnYW1lT3ZlciA9IGZhbHNlO1xuLy8gICAgIH1cbi8vICAgfSk7XG4vLyAgIHJldHVybiBnYW1lT3Zlcjtcbi8vIH1cblxuLy8gLy8gYWRkIGlzR2FtZU92ZXIgdG8gYW4gb2JqZWN0XG4vLyBjb25zdCBhZGRpc0dhbWVPdmVyID0gKHN0YXRlKSA9PiAoe1xuLy8gICBpc0dhbWVPdmVyOiAoKSA9PiBpc0dhbWVPdmVyKHN0YXRlKSxcbi8vIH0pO1xuXG4vLyBnYW1lIGJvYXJkIGZhY3RvcnkgZnVuY3Rpb25cbmZ1bmN0aW9uIEdhbWVCb2FyZChnYW1lQm9hcmRMZW4pIHtcbiAgLy8gcG9zaXRpb25zIGluIGdhbWUgYm9hcmRcbiAgY29uc3Qgc3RhdGUgPSB7XG4gICAgcG9zaXRpb25zOiB7fSxcbiAgICBzaGlwczogW10sXG4gICAgZ2FtZUJvYXJkTGVuLFxuICAgIC8vIHVzZWQgYWZ0ZXIgdGhlIHNoaXAgcGxhY2VtZW50XG4gICAgLy8gbWlzc2VkU2hvdHM6IFtdLFxuICAgIC8vIGhpdFNob3RzOiBbXSxcbiAgICAvLyB1bmF2YWlsYWJsZVNob3RzOiBbXSxcbiAgfTtcblxuICAvLyBwb3B1bGF0aW5nIHRoZSBnYW1lIGJvYXJkXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgZ2FtZUJvYXJkTGVuOyBpKyspIHtcbiAgICBmb3IgKGxldCBqID0gMDsgaiA8IGdhbWVCb2FyZExlbjsgaisrKSB7XG4gICAgICBzdGF0ZS5wb3NpdGlvbnNbU3RyaW5nKFtpLCBqXSldID0gXCJlbXB0eVwiO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7XG4gICAgLi4uYWRkR2V0UG9zaXRpb25zKHN0YXRlKSxcbiAgICAuLi5hZGRHZXRTaGlwcyhzdGF0ZSksXG4gICAgLi4uYWRkQ3JlYXRlU2hpcChzdGF0ZSksXG4gICAgLi4uYWRkUmVtb3ZlU2hpcChzdGF0ZSksXG4gICAgLi4uYWRkQ2hhbmdlU2hpcEF4aXMoc3RhdGUpLFxuICAgIC4uLmFkZENoZWNrUGxhY2VtZW50KHN0YXRlKSxcbiAgICAvLyAuLi5hZGRSZWNlaXZlQXR0YWNrKHN0YXRlKSxcbiAgICAvLyAuLi5hZGRHZXRBdHRhY2tzKHN0YXRlKSxcbiAgICAvLyAuLi5hZGRpc0dhbWVPdmVyKHN0YXRlKSxcbiAgICAvLyAuLi5hZGRDaGVja0F0dGFjayhzdGF0ZSksXG4gICAgLi4uYWRkR2V0UG9zaXRpb25zQXJvdW5kU2hpcChzdGF0ZSksXG4gIH07XG59XG5cbmV4cG9ydCBkZWZhdWx0IEdhbWVCb2FyZDtcbi8vIGV4cG9ydCB7IGdldEhpdFNoaXAgfTtcbiIsImltcG9ydCBHYW1lQm9hcmQgZnJvbSBcIi4vZ2FtZUJvYXJkXCI7XG5pbXBvcnQgU2hpcCBmcm9tIFwiLi9zaGlwc1wiO1xuXG5jb25zdCBnYW1lQm9hcmRMZW4gPSAxMDtcblxuLy8gLy8gaW5pdGlhbGl6ZSB0aGUgYXZhaWxhYmxlIHNob3RzXG4vLyBmdW5jdGlvbiBpbml0aWFsaXplU2hvdHMoc3RhdGUpIHtcbi8vICAgZm9yIChsZXQgaSA9IDA7IGkgPCBnYW1lQm9hcmRMZW47IGkrKykge1xuLy8gICAgIGZvciAobGV0IGogPSAwOyBqIDwgZ2FtZUJvYXJkTGVuOyBqKyspIHtcbi8vICAgICAgIHN0YXRlLmF2YWlsYWJsZVNob3RzLnB1c2goU3RyaW5nKFtpLCBqXSkpO1xuLy8gICAgIH1cbi8vICAgfVxuLy8gfVxuXG4vLyBhZGQgZ2V0R2FtZUJvYXJkIG1ldGhvZCB0byBhbiBvYmplY3RcbmNvbnN0IGFkZEdldEdhbWVCb2FyZCA9IChzdGF0ZSkgPT4gKHtcbiAgZ2V0R2FtZUJvYXJkOiAoKSA9PiBzdGF0ZS5nYW1lQm9hcmQsXG59KTtcblxuLy8gYWRkIGdldEdhbWVCb2FyZExlbiBtZXRob2QgdG8gYW4gb2JqZWN0XG5jb25zdCBhZGRHZXRHYW1lQm9hcmRMZW4gPSAoc3RhdGUpID0+ICh7XG4gIGdldEdhbWVCb2FyZExlbjogKCkgPT4gc3RhdGUuZ2FtZUJvYXJkTGVuLFxufSk7XG5cbi8vIG1ldGhvZCBmb3IgY3JlYXRpbmcgdGhlIHNoaXBcbmZ1bmN0aW9uIGNyZWF0ZVNoaXAoc3RhdGUsIGNyZWF0ZVBvcywgbGVuLCBheGlzKSB7XG4gIHJldHVybiBzdGF0ZS5nYW1lQm9hcmQuY3JlYXRlU2hpcChjcmVhdGVQb3MsIGxlbiwgYXhpcyk7XG59XG5cbi8vIGFkZCBjcmVhdGVTaGlwIHRvIHRoZSBwbGF5ZXJcbmNvbnN0IGFkZENyZWF0ZVNoaXAgPSAoc3RhdGUpID0+ICh7XG4gIGNyZWF0ZVNoaXA6IChjcmVhdGVQb3MsIGxlbiwgYXhpcykgPT4gY3JlYXRlU2hpcChzdGF0ZSwgY3JlYXRlUG9zLCBsZW4sIGF4aXMpLFxufSk7XG5cbi8vIG1ldGhvZCBmb3IgY2hlY2tpbmcgdGhlIHNoaXAgcGxhY2VtZW50IHZhbGlkaXR5XG5mdW5jdGlvbiBjaGVja1BsYWNlbWVudChzdGF0ZSwgY3JlYXRlUG9zLCBsZW4sIGF4aXMpIHtcbiAgcmV0dXJuIHN0YXRlLmdhbWVCb2FyZC5jaGVja1BsYWNlbWVudChjcmVhdGVQb3MsIGxlbiwgYXhpcyk7XG59XG5cbi8vIGFkZCBjcmVhdGVTaGlwIHRvIHRoZSBwbGF5ZXJcbmNvbnN0IGFkZENoZWNrUGxhY2VtZW50ID0gKHN0YXRlKSA9PiAoe1xuICBjaGVja1BsYWNlbWVudDogKGNyZWF0ZVBvcywgbGVuLCBheGlzKSA9PlxuICAgIGNoZWNrUGxhY2VtZW50KHN0YXRlLCBjcmVhdGVQb3MsIGxlbiwgYXhpcyksXG59KTtcblxuLy8gbWV0aG9kIGZvciByZW1vdmluZyBhIHNoaXBcbmZ1bmN0aW9uIHJlbW92ZVNoaXAoc3RhdGUsIHNoaXApIHtcbiAgc3RhdGUuZ2FtZUJvYXJkLnJlbW92ZVNoaXAoc2hpcCk7XG59XG5cbi8vIGFkZCByZW1vdmVTaGlwIHRvIHRoZSBwbGF5ZXJcbmNvbnN0IGFkZFJlbW92ZVNoaXAgPSAoc3RhdGUpID0+ICh7XG4gIHJlbW92ZVNoaXA6IChzaGlwKSA9PiB7XG4gICAgcmVtb3ZlU2hpcChzdGF0ZSwgc2hpcCk7XG4gIH0sXG59KTtcblxuLy8gbWV0aG9kIGZvciByZW1vdmluZyBhIHNoaXBcbmZ1bmN0aW9uIGNoYW5nZVNoaXBBeGlzKHN0YXRlLCBzaGlwKSB7XG4gIHJldHVybiBzdGF0ZS5nYW1lQm9hcmQuY2hhbmdlU2hpcEF4aXMoc2hpcCk7XG59XG5cbi8vIGFkZCByZW1vdmVTaGlwIHRvIHRoZSBwbGF5ZXJcbmNvbnN0IGFkZENoYW5nZVNoaXBBeGlzID0gKHN0YXRlKSA9PiAoe1xuICBjaGFuZ2VTaGlwQXhpczogKHNoaXApID0+IGNoYW5nZVNoaXBBeGlzKHN0YXRlLCBzaGlwKSxcbn0pO1xuXG4vLyByZXR1cm5zIGEgcmFuZG9tIGF4aXMgOiAneCcgb3IgJ3knXG5mdW5jdGlvbiBnZXRSYW5kb21BeGlzKCkge1xuICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwKSAlIDIgPT09IDAgPyBcInhcIiA6IFwieVwiO1xufVxuXG4vLyByZXR1cm5zIGEgcmFuZG9tIHBvc2l0aW9uXG5mdW5jdGlvbiBnZXRSYW5kb21Qb3NpdGlvbihhbGxQb3NpdGlvbnMpIHtcbiAgY29uc3QgcmFuZG9tUG9zID1cbiAgICBhbGxQb3NpdGlvbnNbTWF0aC5mbG9vcihhbGxQb3NpdGlvbnMubGVuZ3RoICogTWF0aC5yYW5kb20oKSldO1xuICByZXR1cm4gcmFuZG9tUG9zO1xufVxuXG4vLyBtZXRob2QgcmV0dXJucyBhIFNoaXAgd2l0aCByYW5kb20gY3JlYXRlIGxvY2F0aW9uIGFuZCBheGlzICBhbmQgZ2l2ZW4gbGVuZ3RoXG5mdW5jdGlvbiBnZXRSYW5kb21TaGlwKHN0YXRlLCBsZW4pIHtcbiAgY29uc3QgYWxsUG9zaXRpb25zID0gW107XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgZ2FtZUJvYXJkTGVuOyBpKyspIHtcbiAgICBmb3IgKGxldCBqID0gMDsgaiA8IGdhbWVCb2FyZExlbjsgaisrKSB7XG4gICAgICBhbGxQb3NpdGlvbnMucHVzaChbaSwgal0pO1xuICAgIH1cbiAgfVxuICB3aGlsZSAodHJ1ZSkge1xuICAgIGNvbnN0IHJhbmRvbVBvcyA9IGdldFJhbmRvbVBvc2l0aW9uKGFsbFBvc2l0aW9ucyk7XG4gICAgY29uc3QgcmFuZG9tQXhpcyA9IGdldFJhbmRvbUF4aXMoKTtcbiAgICBpZiAoY2hlY2tQbGFjZW1lbnQoc3RhdGUsIHJhbmRvbVBvcywgbGVuLCByYW5kb21BeGlzKSkge1xuICAgICAgcmV0dXJuIFNoaXAocmFuZG9tUG9zLCBsZW4sIHJhbmRvbUF4aXMpO1xuICAgIH1cbiAgICBjb25zdCBvdGhlckF4aXMgPSByYW5kb21BeGlzID09PSBcInhcIiA/IFwieVwiIDogXCJ4XCI7XG4gICAgaWYgKGNoZWNrUGxhY2VtZW50KHN0YXRlLCByYW5kb21Qb3MsIGxlbiwgb3RoZXJBeGlzKSkge1xuICAgICAgcmV0dXJuIFNoaXAocmFuZG9tUG9zLCBsZW4sIG90aGVyQXhpcyk7XG4gICAgfVxuICAgIGFsbFBvc2l0aW9ucy5zcGxpY2UoYWxsUG9zaXRpb25zLmluZGV4T2YocmFuZG9tUG9zKSwgMSk7XG4gIH1cbn1cblxuLy8gYWRkIGdldFJhbmRvbVNoaXAgdG8gcGxheWVyXG5jb25zdCBhZGRHZXRSYW5kb21TaGlwID0gKHN0YXRlKSA9PiAoe1xuICBnZXRSYW5kb21TaGlwOiAobGVuKSA9PiBnZXRSYW5kb21TaGlwKHN0YXRlLCBsZW4pLFxufSk7XG5cbmZ1bmN0aW9uIGNsZWFyKHN0YXRlKSB7XG4gIGNvbnN0IHNoaXBzID0gWy4uLnN0YXRlLmdhbWVCb2FyZC5nZXRTaGlwcygpXTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwcy5sZW5ndGg7IGkrKykge1xuICAgIHN0YXRlLmdhbWVCb2FyZC5yZW1vdmVTaGlwKHNoaXBzW2ldKTtcbiAgfVxufVxuXG5jb25zdCBhZGRDbGVhciA9IChzdGF0ZSkgPT4gKHtcbiAgY2xlYXI6ICgpID0+IHtcbiAgICBjbGVhcihzdGF0ZSk7XG4gIH0sXG59KTtcblxuLy8gLy8gYWRkIGFkZEdldEF2YWlsYWJsZVNob3RzIG1ldGhvZCB0byBhbiBvYmplY3Rcbi8vIGNvbnN0IGFkZEdldEF2YWlsYWJsZVNob3RzID0gKHN0YXRlKSA9PiAoe1xuLy8gICBnZXRBdmFpbGFibGVTaG90czogKCkgPT4gc3RhdGUuYXZhaWxhYmxlU2hvdHMsXG4vLyB9KTtcblxuLy8gLy8gYXR0YWNrIG1ldGhvZFxuLy8gZnVuY3Rpb24gYXR0YWNrKHN0YXRlLCBvcG9uZW50Qm9hcmQsIHBvc2l0aW9uKSB7XG4vLyAgIGNvbnN0IHBvc2l0aW9uSW5kZXggPSBzdGF0ZS5hdmFpbGFibGVTaG90cy5pbmRleE9mKFN0cmluZyhwb3NpdGlvbikpO1xuLy8gICBvcG9uZW50Qm9hcmQucmVjZWl2ZUF0dGFjayhwb3NpdGlvbik7XG4vLyAgIHN0YXRlLmF2YWlsYWJsZVNob3RzLnNwbGljZShwb3NpdGlvbkluZGV4LCAxKTtcbi8vIH1cblxuLy8gLy8gYWRkIGF0dGFjayBtZXRob2QgdG8gYW4gb2JqZWN0XG4vLyBjb25zdCBhZGRBdHRhY2sgPSAoc3RhdGUpID0+ICh7XG4vLyAgIGF0dGFjazogKG9wb25lbnRCb2FyZCwgcG9zaXRpb24pID0+IGF0dGFjayhzdGF0ZSwgb3BvbmVudEJvYXJkLCBwb3NpdGlvbiksXG4vLyB9KTtcblxuLy8gLy8gbWV0aG9kIGZvciBhaSB0byBjaG9vc2UgYW4gYXR0YWNrIHBvc2l0aW9uXG4vLyBmdW5jdGlvbiBnZXRBdHRhY2tQb3NpdGlvbihzdGF0ZSkge1xuLy8gICBjb25zdCBsZW4gPSBzdGF0ZS5hdmFpbGFibGVTaG90cy5sZW5ndGg7XG4vLyAgIGNvbnN0IGkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBsZW4pO1xuLy8gICByZXR1cm4gc3RhdGUuYXZhaWxhYmxlU2hvdHNbaV07XG4vLyB9XG5cbi8vIC8vIGFkZCBnZXRBdHRhY2tQb3NpdGlvbiBtZXRob2QgdG8gYW4gb2JqZWN0XG4vLyBjb25zdCBhZGRHZXRBdHRhY2tQb3NpdGlvbiA9IChzdGF0ZSkgPT4gKHtcbi8vICAgZ2V0QXR0YWNrUG9zaXRpb246ICgpID0+IGdldEF0dGFja1Bvc2l0aW9uKHN0YXRlKSxcbi8vIH0pO1xuXG4vLyBmYWN0b3J5IGZ1bmN0aW9uIGZvciBodW1hbiBQbGF5ZXJcbmZ1bmN0aW9uIFBsYXllcigpIHtcbiAgY29uc3Qgc3RhdGUgPSB7XG4gICAgZ2FtZUJvYXJkOiBHYW1lQm9hcmQoZ2FtZUJvYXJkTGVuKSxcbiAgICBnYW1lQm9hcmRMZW4sXG4gICAgLy8gYXZhaWxhYmxlU2hvdHM6IFtdLFxuICB9O1xuXG4gIC8vIGluaXRpYWxpemVTaG90cyhzdGF0ZSk7XG5cbiAgcmV0dXJuIHtcbiAgICAuLi5hZGRHZXRHYW1lQm9hcmQoc3RhdGUpLFxuICAgIC4uLmFkZEdldEdhbWVCb2FyZExlbihzdGF0ZSksXG4gICAgLi4uYWRkQ3JlYXRlU2hpcChzdGF0ZSksXG4gICAgLi4uYWRkQ2hlY2tQbGFjZW1lbnQoc3RhdGUpLFxuICAgIC4uLmFkZFJlbW92ZVNoaXAoc3RhdGUpLFxuICAgIC4uLmFkZENoYW5nZVNoaXBBeGlzKHN0YXRlKSxcbiAgICAuLi5hZGRHZXRSYW5kb21TaGlwKHN0YXRlKSxcbiAgICAuLi5hZGRDbGVhcihzdGF0ZSksXG4gICAgLy8gLi4uYWRkR2V0QXZhaWxhYmxlU2hvdHMoc3RhdGUpLFxuICAgIC8vIC4uLmFkZEF0dGFjayhzdGF0ZSksXG4gIH07XG59XG5cbi8vIGZhY3RvcnkgZnVuY3Rpb24gZm9yIGFpIFBsYXllclxuZnVuY3Rpb24gQWlQbGF5ZXIoKSB7XG4gIGNvbnN0IHN0YXRlID0ge1xuICAgIGdhbWVCb2FyZDogR2FtZUJvYXJkKGdhbWVCb2FyZExlbiksXG4gICAgZ2FtZUJvYXJkTGVuLFxuICAgIC8vIGF2YWlsYWJsZVNob3RzOiBbXSxcbiAgfTtcblxuICAvLyBpbml0aWFsaXplU2hvdHMoc3RhdGUpO1xuXG4gIHJldHVybiB7XG4gICAgLi4uYWRkR2V0R2FtZUJvYXJkKHN0YXRlKSxcbiAgICAuLi5hZGRHZXRHYW1lQm9hcmRMZW4oc3RhdGUpLFxuICAgIC4uLmFkZENyZWF0ZVNoaXAoc3RhdGUpLFxuICAgIC4uLmFkZENoZWNrUGxhY2VtZW50KHN0YXRlKSxcbiAgICAuLi5hZGRSZW1vdmVTaGlwKHN0YXRlKSxcbiAgICAuLi5hZGRDaGFuZ2VTaGlwQXhpcyhzdGF0ZSksXG4gICAgLi4uYWRkR2V0UmFuZG9tU2hpcChzdGF0ZSksXG4gICAgLi4uYWRkQ2xlYXIoc3RhdGUpLFxuICAgIC8vIC4uLmFkZEdldEF2YWlsYWJsZVNob3RzKHN0YXRlKSxcbiAgICAvLyAuLi5hZGRBdHRhY2soc3RhdGUpLFxuICAgIC8vIC4uLmFkZEdldEF0dGFja1Bvc2l0aW9uKHN0YXRlKSxcbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgUGxheWVyO1xuZXhwb3J0IHsgZ2FtZUJvYXJkTGVuLCBBaVBsYXllciwgZ2V0UmFuZG9tQXhpcyB9O1xuIiwiaW1wb3J0IHsgcHJlZGljdFNoaXBQb3NpdGlvbnMgfSBmcm9tIFwiLi9zaGlwc1wiO1xuaW1wb3J0IHtcbiAgbWFya1NoaXBPbkJvYXJkLFxuICByZW1vdmVTaGlwRnJvbUJvYXJkLFxuICBwb3B1bGF0ZWRTZXR1cEJvYXJkLFxuICBjbGVhckJvYXJkRGl2LFxufSBmcm9tIFwiLi9zZXR1cC1kb21cIjtcbmltcG9ydCBQbGF5ZXIgZnJvbSBcIi4vcGxheWVyXCI7XG5cbi8vIHNoaXBzIHRvIGJlIGNyZWF0ZWQgbGVuXG5jb25zdCBzaGlwc0xlbmdodHMgPSBbNCwgMywgMywgMiwgMiwgMiwgMSwgMSwgMSwgMV07XG5cbi8vIGNyZWF0ZXMgYSBzaGlwIG9uIGJvYXJkIGRpdiBhbmQgaW4gcGxheWVycyBib2FyZCBvYmplY3RcbmZ1bmN0aW9uIGNyZWF0ZVNoaXAocGxheWVyLCBib2FyZERpdiwgY3JlYXRlUG9zLCBsZW4sIGF4aXMpIHtcbiAgY29uc3Qgc2hpcCA9IHBsYXllci5jcmVhdGVTaGlwKGNyZWF0ZVBvcywgbGVuLCBheGlzKTtcbiAgY29uc3Qgc2hpcFBvc2l0aW9ucyA9IHByZWRpY3RTaGlwUG9zaXRpb25zKGNyZWF0ZVBvcywgbGVuLCBheGlzKTtcbiAgbWFya1NoaXBPbkJvYXJkKHNoaXBQb3NpdGlvbnMsIGJvYXJkRGl2KTtcbiAgcmV0dXJuIHNoaXA7XG59XG5cbi8vIHJlbW92ZXMgYSBzaGlwIGZyb20gYm9hcmQgZGl2IGFuZCBmcm9tIHBsYXllcidzIGJvYXJkIG9iamVjdFxuZnVuY3Rpb24gcmVtb3ZlU2hpcChzaGlwLCBwbGF5ZXIsIGJvYXJkRGl2KSB7XG4gIHBsYXllci5yZW1vdmVTaGlwKHNoaXApO1xuICBjb25zdCBzaGlwUG9zaXRpb25zID0gcHJlZGljdFNoaXBQb3NpdGlvbnMoXG4gICAgc2hpcC5nZXRDcmVhdGVQb3MoKSxcbiAgICBzaGlwLmdldExlbigpLFxuICAgIHNoaXAuZ2V0QXhpcygpXG4gICk7XG4gIHJlbW92ZVNoaXBGcm9tQm9hcmQoc2hpcFBvc2l0aW9ucywgYm9hcmREaXYpO1xufVxuXG4vLyBjaGFuZ2VzIGEgc2hpcCBheGlzIGluIGJvYXJkIGRpdiBhbmQgaW4gcGxheWVyJ3MgYm9hcmQgb2JqZWN0IGlmIHBvc3NpYmxlXG5mdW5jdGlvbiBjaGFuZ2VTaGlwQXhpcyhzaGlwLCBwbGF5ZXIsIGJvYXJkRGl2KSB7XG4gIHJlbW92ZVNoaXAoc2hpcCwgcGxheWVyLCBib2FyZERpdik7XG4gIGNvbnN0IGNyZWF0ZVBvcyA9IHNoaXAuZ2V0Q3JlYXRlUG9zKCk7XG4gIGNvbnN0IGxlbiA9IHNoaXAuZ2V0TGVuKCk7XG4gIGNvbnN0IG9sZEF4aXMgPSBzaGlwLmdldEF4aXMoKTtcbiAgY29uc3QgbmV3QXhpcyA9IG9sZEF4aXMgPT09IFwieFwiID8gXCJ5XCIgOiBcInhcIjtcbiAgaWYgKHBsYXllci5jaGVja1BsYWNlbWVudChjcmVhdGVQb3MsIGxlbiwgbmV3QXhpcykpXG4gICAgcmV0dXJuIGNyZWF0ZVNoaXAocGxheWVyLCBib2FyZERpdiwgY3JlYXRlUG9zLCBsZW4sIG5ld0F4aXMpO1xuXG4gIHJldHVybiBjcmVhdGVTaGlwKHBsYXllciwgYm9hcmREaXYsIGNyZWF0ZVBvcywgbGVuLCBvbGRBeGlzKTtcbn1cblxuLy8gcG9wdWxhdGUgdGhlIGJvYXJkIGRpdiBhbmQgcGxheWVycyBib2FyZFxuLy8gd2l0aCByYW5kb20gc2hpcHMgd2l0aCBzaGlwc0xlbmd0aHMgZGVmaW5lZCBiZWZvcmVcbmZ1bmN0aW9uIHBvcHVsYXRlQm9hcmRSYW5kb20ocGxheWVyLCBib2FyZERpdiwgc2hpcHNMZW5naHRzKSB7XG4gIHNoaXBzTGVuZ2h0cy5mb3JFYWNoKChsZW4pID0+IHtcbiAgICBjb25zdCBzaGlwID0gcGxheWVyLmdldFJhbmRvbVNoaXAobGVuKTtcbiAgICBjcmVhdGVTaGlwKHBsYXllciwgYm9hcmREaXYsIHNoaXAuZ2V0Q3JlYXRlUG9zKCksIGxlbiwgc2hpcC5nZXRBeGlzKCkpO1xuICB9KTtcbn1cblxuLy8gZnVuY3Rpb24gY3JlYXRlUmFuZG9tQm9hcmQoKVxuXG4vLyBpbml0aWFsaXplIHRoZSBzZXR1cFxuZnVuY3Rpb24gaW5pdGlhbGl6ZVNldHVwKG1haW5EaXYpIHtcbiAgY29uc3QgYm9hcmREaXYgPSBwb3B1bGF0ZWRTZXR1cEJvYXJkKCk7XG4gIGNvbnN0IHBsYXllciA9IFBsYXllcigpO1xuICBjb25zdCBib2FyZERpdkNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gIGJvYXJkRGl2Q29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJib2FyZC1jb250YWluZXJcIik7XG4gIGJvYXJkRGl2Q29udGFpbmVyLmFwcGVuZENoaWxkKGJvYXJkRGl2KTtcbiAgY29uc3QgcmFuZG9tQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgcmFuZG9tQnV0dG9uLnRleHRDb250ZW50ID0gXCJyYW5kb21cIjtcbiAgcmFuZG9tQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJyYW5kb21cIik7XG4gIG1haW5EaXYuYXBwZW5kQ2hpbGQoYm9hcmREaXZDb250YWluZXIpO1xuICBtYWluRGl2LmFwcGVuZENoaWxkKHJhbmRvbUJ1dHRvbik7XG4gIHJhbmRvbUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIHBsYXllci5jbGVhcigpO1xuICAgIGNsZWFyQm9hcmREaXYoYm9hcmREaXYpO1xuICAgIHBvcHVsYXRlQm9hcmRSYW5kb20ocGxheWVyLCBib2FyZERpdiwgc2hpcHNMZW5naHRzKTtcbiAgfSk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGluaXRpYWxpemVTZXR1cDtcblxuZXhwb3J0IHtcbiAgc2hpcHNMZW5naHRzLFxuICBjcmVhdGVTaGlwLFxuICByZW1vdmVTaGlwLFxuICBjaGFuZ2VTaGlwQXhpcyxcbiAgcG9wdWxhdGVCb2FyZFJhbmRvbSxcbn07XG4iLCJpbXBvcnQgeyBnYW1lQm9hcmRMZW4gYXMgbGVuIH0gZnJvbSBcIi4vcGxheWVyXCI7XG5cbi8vIHJldHVybnMgYSBwb3B1bGF0ZWQgZGl2IHdlIHVzZSBhcyBib2FyZCBmb3IgcGxhY2luZyBzaGlwIGluXG5mdW5jdGlvbiBwb3B1bGF0ZWRTZXR1cEJvYXJkKCkge1xuICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgZm9yIChsZXQgaiA9IDA7IGogPCBsZW47IGorKykge1xuICAgICAgY29uc3QgcG9zaXRpb25EaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgcG9zaXRpb25EaXYuY2xhc3NMaXN0LmFkZChcInBvc2l0aW9uXCIsIGBwLSR7aX0tJHtqfWApO1xuICAgICAgZGl2LmFwcGVuZENoaWxkKHBvc2l0aW9uRGl2KTtcbiAgICB9XG4gIH1cbiAgZGl2LmNsYXNzTGlzdC5hZGQoXCJnYW1lLWJvYXJkXCIpO1xuICByZXR1cm4gZGl2O1xufVxuXG4vLyBhZGRzIGV2ZW50IHRvIGNsaWNrIG9uIGVhY2ggZWxlbWVudCBvZiBib2FyZCBkaXZcbmZ1bmN0aW9uIGFkZEV2ZW50VG9Cb2FyZChib2FyZERpdiwgY2IpIHtcbiAgWy4uLmJvYXJkRGl2LmNoaWxkcmVuXS5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG4gICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgY2IpO1xuICB9KTtcbn1cblxuLy8gbWFya3MgYSBzaGlwIG9uIGJvYXJkXG5mdW5jdGlvbiBtYXJrU2hpcE9uQm9hcmQoc2hpcFBvc2l0aW9ucywgYm9hcmREaXYpIHtcbiAgc2hpcFBvc2l0aW9ucy5mb3JFYWNoKChwKSA9PiB7XG4gICAgY29uc3Qgc2VsZWN0b3IgPSBgLnAtJHtTdHJpbmcocCkucmVwbGFjZShcIixcIiwgXCItXCIpfWA7XG4gICAgY29uc3QgZG9tID0gYm9hcmREaXYucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XG4gICAgZG9tLmNsYXNzTGlzdC5hZGQoXCJzaGlwXCIpO1xuICB9KTtcbn1cblxuLy8gcmVtb3ZlcyBhIHNoaXAgZnJvbSBib2FyZFxuZnVuY3Rpb24gcmVtb3ZlU2hpcEZyb21Cb2FyZChzaGlwUG9zaXRpb25zLCBib2FyZERpdikge1xuICBzaGlwUG9zaXRpb25zLmZvckVhY2goKHApID0+IHtcbiAgICBjb25zdCBzZWxlY3RvciA9IGAucC0ke1N0cmluZyhwKS5yZXBsYWNlKFwiLFwiLCBcIi1cIil9YDtcbiAgICBjb25zdCBkb20gPSBib2FyZERpdi5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTtcbiAgICBkb20uY2xhc3NMaXN0LnJlbW92ZShcInNoaXBcIik7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBjbGVhckJvYXJkRGl2KGJvYXJkRGl2KSB7XG4gIFsuLi5ib2FyZERpdi5jaGlsZHJlbl0uZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xuICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcInNoaXBcIik7XG4gIH0pO1xufVxuXG5leHBvcnQge1xuICBwb3B1bGF0ZWRTZXR1cEJvYXJkLFxuICBhZGRFdmVudFRvQm9hcmQsXG4gIG1hcmtTaGlwT25Cb2FyZCxcbiAgcmVtb3ZlU2hpcEZyb21Cb2FyZCxcbiAgY2xlYXJCb2FyZERpdixcbn07XG5cbi8vIGltcG9ydCBQbGF5ZXIsIHsgQWlQbGF5ZXIsIGdhbWVCb2FyZExlbiBhcyBsZW4gfSBmcm9tIFwiLi9wbGF5ZXJcIjtcbi8vIGltcG9ydCB7IHByZWRpY3RTaGlwUG9zaXRpb25zIH0gZnJvbSBcIi4vc2hpcHNcIjtcbi8vIGltcG9ydCB7IGdldEhpdFNoaXAgfSBmcm9tIFwiLi9nYW1lQm9hcmRcIjtcblxuLy8gLy8gcGxhY2Ugc2hpcCBpbiBEb21cbi8vIGZ1bmN0aW9uIHBsYWNlU2hpcEluRG9tKHNoaXBQb3NpdGlvbnMsIGJvYXJkRG9tKSB7XG4vLyAgIHNoaXBQb3NpdGlvbnMuZm9yRWFjaCgocCkgPT4ge1xuLy8gICAgIGNvbnN0IHNlbGVjdG9yID0gYC5wLSR7U3RyaW5nKHApLnJlcGxhY2UoXCIsXCIsIFwiLVwiKX1gO1xuLy8gICAgIGNvbnN0IGRvbSA9IGJvYXJkRG9tLnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpO1xuLy8gICAgIGRvbS5jbGFzc0xpc3QuYWRkKFwic2hpcFwiKTtcbi8vICAgfSk7XG4vLyB9XG5cbi8vIC8vIHBvcHVsYXRlIGh1bWFuIGJvYXJkXG4vLyBmdW5jdGlvbiBwb3BIYm9hcmQoYm9hcmREb20sIGxlbikge1xuLy8gICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4vLyAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBsZW47IGorKykge1xuLy8gICAgICAgY29uc3QgcG9zaXRpb25Eb20gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuLy8gICAgICAgcG9zaXRpb25Eb20uY2xhc3NMaXN0LmFkZChcInBvc2l0aW9uXCIsIGBwLSR7aX0tJHtqfWApO1xuLy8gICAgICAgYm9hcmREb20uYXBwZW5kQ2hpbGQocG9zaXRpb25Eb20pO1xuLy8gICAgIH1cbi8vICAgfVxuLy8gfVxuXG4vLyAvLyBwbGFjZSBzaGlwIGluIGJvYXJkXG4vLyBmdW5jdGlvbiBwbGFjZVNoaXAocGxheWVyLCBib2FyZERvbSwgY3JlYXRlUG9zLCBsZW4sIGF4aXMpIHtcbi8vICAgY29uc3QgYm9hcmQgPSBwbGF5ZXIuZ2V0R2FtZUJvYXJkKCk7XG4vLyAgIGJvYXJkLmNyZWF0ZVNoaXAoY3JlYXRlUG9zLCBsZW4sIGF4aXMpO1xuLy8gICBjb25zdCBzaGlwUG9zaXRpb25zID0gcHJlZGljdFNoaXBQb3NpdGlvbnMoY3JlYXRlUG9zLCBsZW4sIGF4aXMpO1xuLy8gICBwbGFjZVNoaXBJbkRvbShzaGlwUG9zaXRpb25zLCBib2FyZERvbSk7XG4vLyB9XG5cbi8vIC8vIGV2ZW50IGxpc3RlbmVyIGZvciBhdHRhY2tpbmcgYWkgYm9hcmQgc28gd2UgY2FuIHJlbW92ZSBpdCBsYXRlclxuLy8gbGV0IGF0dGFja0V2ZW50TGlzdGVuZXI7XG4vLyAvLyBib2FyZCBkb20gY2FuIHJlY2VpdmUgYXR0YWNrXG4vLyBmdW5jdGlvbiByZWNlaXZlQXR0YWNrRG9tKGJvYXJkLCBib2FyZERvbSwgYXR0YWNrZXIsIHBvc2l0aW9uLCBwb3NpdGlvbkRvbSkge1xuLy8gICBhdHRhY2tlci5hdHRhY2soYm9hcmQsIHBvc2l0aW9uKTtcbi8vICAgaWYgKGJvYXJkLmNoZWNrQXR0YWNrKHBvc2l0aW9uKSkge1xuLy8gICAgIHBvc2l0aW9uRG9tLnRleHRDb250ZW50ID0gXCJYXCI7XG4vLyAgICAgY29uc3Qgc2hpcCA9IGdldEhpdFNoaXAoYm9hcmQuZ2V0U2hpcHMoKSwgcG9zaXRpb24pO1xuLy8gICAgIGlmIChzaGlwLmlzU3VuaygpKSB7XG4vLyAgICAgICBjb25zdCBwb3NpdGlvbnNBcm91bmRTaGlwID0gYm9hcmQuZ2V0UG9zaXRpb25zQXJvdW5kU2hpcChzaGlwKTtcbi8vICAgICAgIHBvc2l0aW9uc0Fyb3VuZFNoaXAuZm9yRWFjaCgocCkgPT4ge1xuLy8gICAgICAgICBjb25zdCBzZWxlY3RvciA9IGAucC0ke1N0cmluZyhwKS5yZXBsYWNlKFwiLFwiLCBcIi1cIil9YDtcbi8vICAgICAgICAgY29uc3QgZG9tID0gYm9hcmREb20ucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XG4vLyAgICAgICAgIGRvbS50ZXh0Q29udGVudCA9IFwiT1wiO1xuLy8gICAgICAgICBkb20uY2xhc3NMaXN0LnJlbW92ZShcInNlbGVjdGFibGVcIik7XG4vLyAgICAgICB9KTtcbi8vICAgICB9XG4vLyAgIH0gZWxzZSB7XG4vLyAgICAgcG9zaXRpb25Eb20udGV4dENvbnRlbnQgPSBcIk9cIjtcbi8vICAgfVxuLy8gfVxuXG4vLyBmdW5jdGlvbiBhaUF0dGFja3MoaHVtYW5Cb2FyZCwgaHVtYW5Cb2FyZERvbSwgYWlQbGF5ZXIpIHtcbi8vICAgY29uc3QgYXR0YWNrUG9zaXRpb24gPSBhaVBsYXllci5nZXRBdHRhY2tQb3NpdGlvbigpO1xuLy8gICBjb25zdCBzZWxlY3RvciA9IGAucC0ke1N0cmluZyhhdHRhY2tQb3NpdGlvbikucmVwbGFjZShcIixcIiwgXCItXCIpfWA7XG4vLyAgIGNvbnN0IHBvc2l0aW9uRG9tID0gaHVtYW5Cb2FyZERvbS5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTtcbi8vICAgcmVjZWl2ZUF0dGFja0RvbShcbi8vICAgICBodW1hbkJvYXJkLFxuLy8gICAgIGh1bWFuQm9hcmREb20sXG4vLyAgICAgYWlQbGF5ZXIsXG4vLyAgICAgYXR0YWNrUG9zaXRpb24sXG4vLyAgICAgcG9zaXRpb25Eb21cbi8vICAgKTtcbi8vIH1cblxuLy8gLy8gcG9wdWxhdGUgQWkgYm9hcmRcbi8vIGZ1bmN0aW9uIHBvcEFpQm9hcmQoXG4vLyAgIGFpUGxheWVyLFxuLy8gICBhaUJvYXJkLFxuLy8gICBhaUJvYXJkRG9tLFxuLy8gICBodW1hblBsYXllcixcbi8vICAgaHVtYW5Cb2FyZCxcbi8vICAgaHVtYW5Cb2FyZERvbSxcbi8vICAgbGVuXG4vLyApIHtcbi8vICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuLy8gICAgIGZvciAobGV0IGogPSAwOyBqIDwgbGVuOyBqKyspIHtcbi8vICAgICAgIGNvbnN0IHBvc2l0aW9uRG9tID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbi8vICAgICAgIHBvc2l0aW9uRG9tLmNsYXNzTGlzdC5hZGQoXCJwb3NpdGlvblwiLCBgcC0ke2l9LSR7an1gLCBcInNlbGVjdGFibGVcIik7XG4vLyAgICAgICBhaUJvYXJkRG9tLmFwcGVuZENoaWxkKHBvc2l0aW9uRG9tKTtcbi8vICAgICAgIGF0dGFja0V2ZW50TGlzdGVuZXIgPSAoKSA9PiB7XG4vLyAgICAgICAgIC8vICB0byBjaGVjayBpZiBzaG90IGlzIGF2YWlsYWJsZVxuLy8gICAgICAgICBpZiAoYWlCb2FyZC5nZXRBdHRhY2tzKCkudW5hdmFpbGFibGVTaG90cy5pbmNsdWRlcyhTdHJpbmcoW2ksIGpdKSkpIHtcbi8vICAgICAgICAgICByZXR1cm47XG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgcmVjZWl2ZUF0dGFja0RvbShhaUJvYXJkLCBhaUJvYXJkRG9tLCBodW1hblBsYXllciwgW2ksIGpdLCBwb3NpdGlvbkRvbSk7XG4vLyAgICAgICAgIGlmIChhaUJvYXJkLmlzR2FtZU92ZXIoKSkge1xuLy8gICAgICAgICAgIGNvbnNvbGUubG9nKFwicGxheWVyIHdvblwiKTtcbi8vICAgICAgICAgICBhaUJvYXJkRG9tLmNsYXNzTGlzdC5hZGQoXCJnYW1lLW92ZXJcIik7XG4vLyAgICAgICAgICAgcmV0dXJuO1xuLy8gICAgICAgICB9XG4vLyAgICAgICAgIGFpQXR0YWNrcyhodW1hbkJvYXJkLCBodW1hbkJvYXJkRG9tLCBhaVBsYXllcik7XG4vLyAgICAgICAgIGlmIChodW1hbkJvYXJkLmlzR2FtZU92ZXIoKSkge1xuLy8gICAgICAgICAgIGNvbnNvbGUubG9nKFwiYWkgd29uXCIpO1xuLy8gICAgICAgICAgIGFpQm9hcmREb20uY2xhc3NMaXN0LmFkZChcImdhbWUtb3ZlclwiKTtcbi8vICAgICAgICAgICByZXR1cm47XG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgcG9zaXRpb25Eb20uY2xhc3NMaXN0LnJlbW92ZShcInNlbGVjdGFibGVcIik7XG4vLyAgICAgICAgIC8vIGNoZWNrIGlmIGdhbWUgaXMgb3ZlclxuLy8gICAgICAgfTtcbi8vICAgICAgIHBvc2l0aW9uRG9tLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhdHRhY2tFdmVudExpc3RlbmVyLCB7XG4vLyAgICAgICAgIG9uY2U6IHRydWUsXG4vLyAgICAgICAgIGNhcHR1cmU6IGZhbHNlLFxuLy8gICAgICAgfSk7XG4vLyAgICAgfVxuLy8gICB9XG4vLyB9XG5cbi8vIC8vIGh1bWFuIGFuZCBhaSBwbGF5ZXJzIGFuZCBib2FyZHNcbi8vIGNvbnN0IGhQbGF5ZXIgPSBQbGF5ZXIoKTtcbi8vIGNvbnN0IGFpUGxheWVyID0gQWlQbGF5ZXIoKTtcbi8vIGNvbnN0IGh1bWFuQm9hcmREb20gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbWUtYm9hcmQuaHVtYW5cIik7XG4vLyBjb25zdCBhaUJvYXJkRG9tID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYW1lLWJvYXJkLmFpXCIpO1xuLy8gY29uc3QgYWlCb2FyZCA9IGFpUGxheWVyLmdldEdhbWVCb2FyZCgpO1xuLy8gY29uc3QgaHVtYW5Cb2FyZCA9IGhQbGF5ZXIuZ2V0R2FtZUJvYXJkKCk7XG5cbi8vIC8vIG1haW4gZ2FtZSBsb29wIChwb3BBaUJvYXJkIGlzIHdoZXJlIGxvb3BzIGhhcHBlbnMpXG4vLyBmdW5jdGlvbiBtYWluKCkge1xuLy8gICBwb3BIYm9hcmQoaHVtYW5Cb2FyZERvbSwgbGVuKTtcbi8vICAgcG9wQWlCb2FyZChcbi8vICAgICBhaVBsYXllcixcbi8vICAgICBhaUJvYXJkLFxuLy8gICAgIGFpQm9hcmREb20sXG4vLyAgICAgaFBsYXllcixcbi8vICAgICBodW1hbkJvYXJkLFxuLy8gICAgIGh1bWFuQm9hcmREb20sXG4vLyAgICAgbGVuXG4vLyAgICk7XG4vLyAgIHBsYWNlU2hpcChoUGxheWVyLCBodW1hbkJvYXJkRG9tLCBbMSwgMV0sIDEsIFwieFwiKTtcbi8vICAgcGxhY2VTaGlwKGFpUGxheWVyLCBhaUJvYXJkRG9tLCBbMSwgMV0sIDIsIFwieFwiKTtcbi8vICAgcGxhY2VTaGlwKGFpUGxheWVyLCBhaUJvYXJkRG9tLCBbNSwgNV0sIDQsIFwieVwiKTtcbi8vIH1cblxuLy8gZXhwb3J0IGRlZmF1bHQgbWFpbjtcbi8vIGV4cG9ydCB7IHBsYWNlU2hpcEluRG9tIH07XG4iLCJpbXBvcnQgaW5pdGlhbGl6ZVNldHVwIGZyb20gXCIuL3NldHVwXCI7XG5cbmNvbnN0IG1haW5EaXYgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwibWFpblwiKTtcbmluaXRpYWxpemVTZXR1cChtYWluRGl2KTtcbiJdLCJuYW1lcyI6WyJwcmVkaWN0U2hpcFBvc2l0aW9ucyIsImNyZWF0ZVBvcyIsImxlbiIsImF4aXMiLCJwb3NpdGlvbnMiLCJpIiwiaiIsImsiLCJwdXNoIiwic3RhdGUiLCJwcmVkaWN0ZWRQb3NpdGlvbnMiLCJwIiwiU3RyaW5nIiwic2xpY2UiLCJsYXN0UG9zaXRpb24iLCJnZXRQb3NpdGlvbnMiLCJhZGRHZXRQb3NpdGlvbnMiLCJnZXRMZW4iLCJhZGRHZXRMZW4iLCJnZXRDcmVhdGVQb3MiLCJhZGRHZXRDcmVhdGVQb3MiLCJnZXRMYXN0UG9zIiwiYWRkR2V0TGFzdFBvcyIsImdldEF4aXMiLCJhZGRHZXRBeGlzIiwiY2hhbmdlR2FtZUJvYXJkUG9zaXRpb25zIiwidmFsdWUiLCJmb3JFYWNoIiwiZ2V0U2hpcFBvc2l0aW9ucyIsInNoaXAiLCJPYmplY3QiLCJrZXlzIiwiZ2V0UG9zaXRpb25zQXJvdW5kU2hpcCIsInNoaXBQb3NpdGlvbnMiLCJhcm91bmRQb3NpdGlvbnMiLCJwQXNMaXN0Iiwic3BsaXQiLCJuZXdQb3MiLCJpbmNsdWRlcyIsImNyZWF0ZVNoaXAiLCJTaGlwIiwiY2hhbmdlU2hpcFBvc2l0aW9ucyIsImNoYW5nZUFyb3VuZFNoaXBQb3NpdGlvbnMiLCJzaGlwcyIsImFkZFNoaXBUb0dhbWVCb2FyZFNoaXBzIiwicmVtb3ZlU2hpcCIsImVtcHR5U2hpcFBvc2l0aW9ucyIsImVtcHR5QXJvdW5kU2hpcFBvc2l0aW9uIiwic2hpcEluZGV4IiwiaW5kZXhPZiIsInNwbGljZSIsInJlbW92ZVNoaXBGcm9tR2FtZUJvYXJkU2hpcHMiLCJhZGRDaGVja1BsYWNlbWVudCIsImNoZWNrUGxhY2VtZW50IiwiZ2FtZUJvYXJkTGVuIiwiZ2V0U2hpcHMiLCJhZGRHZXRTaGlwcyIsImFkZENyZWF0ZVNoaXAiLCJhZGRSZW1vdmVTaGlwIiwiY2hhbmdlU2hpcEF4aXMiLCJuZXdBeGlzIiwiYWRkQ2hhbmdlU2hpcEF4aXMiLCJhZGRHZXRQb3NpdGlvbnNBcm91bmRTaGlwIiwiZ2FtZUJvYXJkIiwiZ2V0UmFuZG9tUG9zaXRpb24iLCJhbGxQb3NpdGlvbnMiLCJNYXRoIiwiZmxvb3IiLCJsZW5ndGgiLCJyYW5kb20iLCJhZGRDbGVhciIsImNsZWFyIiwiR2FtZUJvYXJkIiwiZ2V0R2FtZUJvYXJkIiwiYWRkR2V0R2FtZUJvYXJkIiwiZ2V0R2FtZUJvYXJkTGVuIiwiYWRkR2V0R2FtZUJvYXJkTGVuIiwiZ2V0UmFuZG9tU2hpcCIsInJhbmRvbVBvcyIsInJhbmRvbUF4aXMiLCJvdGhlckF4aXMiLCJhZGRHZXRSYW5kb21TaGlwIiwic2hpcHNMZW5naHRzIiwibWFpbkRpdiIsImJvYXJkRGl2IiwiZGl2IiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwicG9zaXRpb25EaXYiLCJjbGFzc0xpc3QiLCJhZGQiLCJhcHBlbmRDaGlsZCIsInBvcHVsYXRlZFNldHVwQm9hcmQiLCJwbGF5ZXIiLCJQbGF5ZXIiLCJib2FyZERpdkNvbnRhaW5lciIsInJhbmRvbUJ1dHRvbiIsInRleHRDb250ZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImNoaWxkcmVuIiwiZWxlbWVudCIsInJlbW92ZSIsImNsZWFyQm9hcmREaXYiLCJzZWxlY3RvciIsInJlcGxhY2UiLCJxdWVyeVNlbGVjdG9yIiwibWFya1NoaXBPbkJvYXJkIiwicG9wdWxhdGVCb2FyZFJhbmRvbSIsImluaXRpYWxpemVTZXR1cCJdLCJzb3VyY2VSb290IjoiIn0=